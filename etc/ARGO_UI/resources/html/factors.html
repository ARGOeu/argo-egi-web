<!DOCTYPE html>
<html xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd" tpl:extends="/lavoisier?accept=html">

<body>
<!-- Right side column. Contains the navbar and content of the page -->
<div id="wrapper">
    <aside class="right-side" id="right-side">
        <!-- Content Header (Page header) -->
        <section class="content-header" id="content-header">
            <h1  tpl:foreach="/nodeData">
                Last Statuses of Sites- {{@profile}} PROFILE
                <small>Tree Map Page </small>

                <button type="button" class="pull-right btn btn-primary" data-toggle="modal" data-target="#myHelp">
                    <div class="fa fa-info"></div>
                </button>


            </h1>




            <div class="modal fade " id="myHelp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
                            <h3 class="modal-title" id="myModalLabel">Help  <i class="ion ion-clipboard"></i></h3>
                        </div>
                        <div class="modal-body">
                            <ul>
                                <li>The size of the square is determined by the weight of the sites belonging to the ngi (1st level) or the weight of the site itself (2d level)</li>
                                <li class="info-box-text">The color is determined by the statuses of the sites belonging to a ngi or by the status of the site itself</li>
                                <li class="info-box-text">Left-click to move down the tree and right-click on the graph to move back up the tree</li>
                            </ul>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>

                        </div>
                    </div>
                </div>
            </div>

        </section>

        <!-- Main content -->
        <section class="content" id="content">


            <small>Left-click to move down the tree and right-click on the graph to move back up the tree</small>

            <div id="global_groups" style="display:none">
                <div tpl:foreach="/nodeData/children[@Parent='EGI']">{{@id}},EGI,0,0</div>
            </div>



            <div  id="local_groups" style="display: none">
                <div tpl:foreach="/nodeData/children[@Parent!='EGI']" >{{@id}},{{@Parent}},{{@weight}},{{@status}}</div>
            </div>


            <div class="pull-right">
               <a tpl:if="/nodeData/@profile!='ROC_CRITICAL'" href="/lavoisier/StatusTreeMap?accept=html" >
                   <span class="label label-primary" >Switch to ROC_CRITICAL profile</span>
               </a>
               <a tpl:else="" href="/lavoisier/StatusTreeMap_Cloud?accept=html">
                   <span class="label label-primary">Switch to EGI FEDCLOUD profile</span>
               </a>
            </div>


            <div id="chart_div" style="width: 1200px; height: 800px;"></div>











        </section><!-- /.content -->
    </aside><!-- /.right-side -->
</div>
</body>






<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript">
    <!--
    var global_groups = document.getElementById('global_groups').getElementsByTagName('div');
    var local_groups= document.getElementById('local_groups').getElementsByTagName('div');

    var toolTips=[];

    var groups=[["Entity","Parent","CPU Factors","Status"],["EGI",null,0,0]];


    for (i=0; i<global_groups.length; i++) {

        var tempArray=global_groups[i].textContent.split(",");
        tempArray[2]=Number(tempArray[2]);
        tempArray[3]=Number(tempArray[3]);
        groups.push(tempArray);
    }



    for (j=0; j<local_groups.length; j++) {

        var tempArray=local_groups[j].textContent.split(",");
        tempArray[2]=Number(tempArray[2]);


        toolTips[tempArray[0]]=tempArray[3];
        if (tempArray[3]=='')
            toolTips[tempArray[0]]='UNKNOWN';

        if (toolTips[tempArray[1]]=== undefined ) {
            toolTips[tempArray[1]] = "<hr/>" + tempArray[0] + " : " + tempArray[3];
        } else
        {
            toolTips[tempArray[1]]= toolTips[tempArray[1]] + "<br/>"+ tempArray[0] + " : "+ tempArray[3];
        }



        if (tempArray[3]=='')
            tempArray[3]=50;

        if (tempArray[3]== 'OK')
            tempArray[3]= 100;

        if (tempArray[3]=='CRITICAL')
            tempArray[3]=0;

        if (tempArray[3]=='WARNING')
            tempArray[3]=10;

        if (tempArray[3]=='UNKNOWN')
            tempArray[3]=50;

        if (tempArray[3]=='MISSING')
            tempArray[3]=40;





        groups.push(tempArray);

    }




    google.load("visualization", "1", {packages:["treemap"]});
    google.setOnLoadCallback(drawChart);
    function drawChart() {


        // Create and populate the data table.
        var data = google.visualization.arrayToDataTable( groups);

        // Create and draw the visualization.
        var tree = new google.visualization.TreeMap(document.getElementById('chart_div'));
        tree.draw(data, {
            minColor: '#f00',
            midColor: '#ddd',
            maxColor: '#0d0',
            headerHeight: 15,
            fontColor: 'black',
            showScale: true,
            generateTooltip: showFullTooltip
        });





        function showFullTooltip(row, size, value) {
            var site = data.getValue(row, 0);

            return            '<div style="background:#c9e2b3; padding:10px; border-style:solid">' +
            '<span style="font-family:Courier">' +
            '<b>'  + data.getValue(row, 0) +'</b><br/>' +
            'CPU Factors :' +  size + '<br/>' +
            site + ' :  '+  toolTips[site]+ '<br/>' +
            '</span><br/></div>' ;

        }

    }
    -->
</script>

</html>