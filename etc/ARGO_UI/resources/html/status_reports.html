<!DOCTYPE html>
<html  xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd"
       xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd"
       tpl:extends="/lavoisier/_default_?accept=html">

<body>
<!-- Right side column. Contains the navbar and content of the page -->
<div id="wrapper">

<aside tpl:if="/e:entries/e:entry/Site" class="left-side" id="left-side">
    <section class="sidebar">
        <ul class="sidebar-menu" style="list-style:none;">

            <li tpl:foreach="/e:entries/e:entry" style="padding-left:20px;">
                <a   href="#{{@key}}" >
                    <i class="fa fa-angle-double-left" style="padding:5px"> </i>
                    <span> {{@key}} </span>
                    <i class="fa fa-angle-double-right" style="padding:5px"> </i>

                </a>


            </li>


        </ul>
    </section>
</aside>

<aside class="right-side" id="right-side">
    <!-- Content Header (Page header) -->
    <section class="content-header" id="content-header">
        <h1>
            Status Reports
            <small>Click on individual bar to access details</small>

            <button type="button" class="pull-right btn btn-primary" data-toggle="modal" data-target="#myHelp">
                <div class="fa fa-info"></div>
            </button>



        </h1>

        <div class="modal fade" id="myHelp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
                        <h4 class="modal-title" id="myModalLabel">Help</h4>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li>The statuses are the following  <span class="badge badge-OK">OK</span> <span class="badge badge-UNKNOWN">UNKNOWN</span> <span class="badge badge-CRITICAL">CRITICAL</span> <span class="badge badge-WARNING">WARNING</span> <span class="badge badge-MISSING">MISSING</span></li>
                            <li class="info-box-text">You can click on the bar to access to the next level of granularity</li>
                            <li class="info-box-text">Left-click to move down the tree and right-click on the graph to move back up the tree</li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>

                    </div>
                </div>
            </div>
        </div>

    </section>

    <!-- Main content -->
    <section class="content" id="content" tpl:if="/root/group/group_ts">



        <div  id="local_groups" tpl:if="not(/root/@url)" style="display: none">
            <div tpl:foreach="/root/group/group_ts" >{{ancestor::group/@name}},{{@value}}_{{position()}},{{@timestamp}},{{@endtime}},{{@color}}</div>
        </div>

            <div  id="local_groups" tpl:else="" style="display: none">
                <div tpl:foreach="/root/group/group_ts" >{{substring-after(ancestor::group/@name,'----')}},{{@value}}_{{position()}},{{@timestamp}},{{@endtime}},{{@color}}</div>
            </div>




        <div  id="local_links" tpl:if="/root/@url" style="display: none">
            <div  tpl:foreach="/root/group/group_ts[@previous_timestamp]" >
                /lavoisier/{{substring-before(ancestor::group/@name,'----')}}&amp;timestamp={{@previous_timestamp}}
            </div>
            <div  tpl:foreach="/root/group/group_ts[not(@previous_timestamp)]" >
                /lavoisier/{{substring-before(ancestor::group/@name,'----')}}&amp;timestamp={{@timestamp}}
            </div>
        </div>
        <div   tpl:else="" style="display: none">
            <div id="local_links" tpl:if="/root/@sf_report">
                <div tpl:foreach="/root/group/group_ts" >/lavoisier/{{ancestor::root[@view]/@view}}?{{ancestor::root[@entity]/@entity}}={{substring-before(ancestor::group/@name,' -')}}&amp;data={{ancestor::root[@data]/@data}}&amp;accept=html</div>
            </div>
            <div id="local_links" tpl:else="">
                <div tpl:foreach="/root/group/group_ts" >/lavoisier/{{ancestor::root[@view]/@view}}?{{ancestor::root[@entity]/@entity}}={{ancestor::group/@name}}&amp;data={{ancestor::root[@data]/@data}}&amp;accept=html</div>
            </div>

        </div>




        <div  class="box box-primary">

            <div tpl:foreach="/root" style="margin:20px" class="title">
                <span > <a href="/lavoisier/choiceNgi?accept=html">EGI </a></span>
                <span tpl:if="@ngi"><a href="/lavoisier/site_status_report?ngi={{@ngi}}&amp;data={{@data}}&amp;accept=html">&gt;{{@ngi}}</a>  </span>
                <span tpl:if="@site"><a href="/lavoisier/site_status_report?ngi=&amp;site={{@site}}&amp;data={{@data}}&amp;accept=html"> &gt; {{@site}} </a> </span>
                <span tpl:if="@sf"><a href="/lavoisier/host_status_report?ngi={{@ngi}}&amp;site={{@site}}&amp;sf={{@sf}}&amp;data={{@data}}&amp;accept=html"> &gt; {{@sf}} </a> </span>
                <span tpl:if="@host"><a href="/lavoisier/metric_status_report?ngi={{@ngi}}&amp;site={{@site}}&amp;sf={{@sf}}&amp;host={{@host}}&amp;data={{@data}}&amp;accept=html"> &gt; {{@host}} </a> </span>
                <div tpl:foreach="/root" style="margin:20px" class="pull-right">
                    <span class="label label-primary">{{@start_time}} </span>  <span class="label label-primary" style="margin-left:15px">{{@end_time}}</span>
                </div>

            </div>

            <div id="div_timeline" style="height: 800px;margin:20px" ></div>

        </div>












    </section><!-- /.content -->

    <section lass="content" id="content"  tpl:else="">

        <div class="alert alert-info"> There are no data registered for this entity and period . </div>
    </section>

</aside><!-- /.right-side -->

<style media="screen" type="text/css">

    .badge-OK {
        background-color: green;

    }
    .badge-UNKNOWN {
        background-color: #d3d3d3;

    }

    .badge-MISSING {
        background-color: #53424a;

    }

    .badge-WARNING {
        background-color: orange

    }

    .badge-CRITICAL{
        background-color:red;

    }




</style>


<script>
    <!--





    $(document).ready(function() {


        var newgroup = [];
        var colorsgroup = [];
        var links = [];


        var local_groups = document.getElementById('local_groups').getElementsByTagName('div');
        var local_links = document.getElementById('local_links').getElementsByTagName('div');


        for (j = 0; j < local_groups.length; j++) {

            var tempArray = local_groups[j].textContent.split(",");
            var color = tempArray.pop();

            tempArray[4]= '<div class="panel panel-default">' +
            '<div class="panel-heading"><div class="panel-title"><h3>'+ tempArray[0] +'</h3></div></div>'
            + '<div class="panel-body">' +
            '<label> Status: &nbsp;<span class="badge badge-'+tempArray[1].split("_")[0] +'">'+tempArray[1].split("_")[0] + '</span></label><hr/>' +
            '<label>Start Time : &nbsp;</label>' + tempArray[2] + '<hr/>' +
            '<label>End Time : &nbsp;</label>' + tempArray[3] + '</div><div class="panel-footer"><em>Click on the bar to access the next granularity level</em></div></div>';

            tempArray[2] = new Date(tempArray[2]);
            tempArray[3] = new Date(tempArray[3]);


            newgroup.push(tempArray);
            colorsgroup.push(color);

        }


        for (m = 0; m < local_links.length; m++) {
            links.push(local_links[m].textContent);
        }

        google.setOnLoadCallback(drawChart);

        function drawChart() {
            var container = document.getElementById('div_timeline');
            var chart = new google.visualization.Timeline(container);

            google.visualization.events.addListener(chart, 'select', function () {
                var selectedItem = chart.getSelection()[0].row;
                window.location = links[selectedItem];

            });





            var dataTable = new google.visualization.DataTable();
            dataTable.addColumn({type: 'string', id: 'Service Flavour'});
            dataTable.addColumn({type: 'string', id: 'Status'});
            dataTable.addColumn({type: 'date', id: 'Start'});
            dataTable.addColumn({type: 'date', id: 'End'});
            dataTable.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});

            dataTable.addRows(newgroup);

            var options = {
                title: 'Status report',
                backgroundColor: '#fff',
                colors : colorsgroup,
                timeline: {
                    groupByRowLabel: true,
                    showBarLabels : false

                }

            };


            function myHandler(e){
                if(e.row != null){
                    $(".google-visualization-tooltip").html(dataTable.getValue(e.row,4)).css({width:"auto",height:"auto"});
                }
            }

            google.visualization.events.addListener(chart, 'onmouseover', myHandler);

            chart.draw(dataTable, options);
        }





    })




    -->
</script>


</div>
</body>
</html>