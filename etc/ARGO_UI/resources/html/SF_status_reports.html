<!DOCTYPE html>
<html  xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd"
       xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd"
       tpl:extends="http://localhost:8080/lavoisier/_default_?accept=html">

<body>
<!-- Right side column. Contains the navbar and content of the page -->
<div id="wrapper">

    <aside tpl:if="/e:entries/e:entry/Site" class="left-side" id="left-side">
        <section class="sidebar">
            <ul class="sidebar-menu" style="list-style:none;">

                <li tpl:foreach="/e:entries/e:entry" style="padding-left:20px;">
                    <a   href="#{{@key}}" >
                        <i class="fa fa-angle-double-left" style="padding:5px"> </i>
                        <span> {{@key}} </span>
                        <i class="fa fa-angle-double-right" style="padding:5px"> </i>

                    </a>


                </li>


            </ul>
        </section>
    </aside>

    <aside class="right-side" id="right-side">
        <!-- Content Header (Page header) -->
        <section class="content-header" id="content-header">
            <h1>
                Status Reports
                <small tpl:foreach="/root/group/@*"> {{.}} </small>
            </h1>

        </section>

        <!-- Main content -->
        <section class="content" id="content" >



            <div  id="local_groups" style="display: none">
                <div tpl:foreach="/root//group_ts" >{{ancestor::group/@name}},{{@value}}_{{position()}},{{@timestamp}},{{@endtime}},{{@color}}</div>
            </div>



            <div  id="local_links" style="display: none">
                <div tpl:foreach="/root//group_ts" >/lavoisier/host_status?sf={{ancestor::root/@site}}&amp;entity={{ancestor::group/@name}}&amp;accept=html</div>
            </div>


            <div  class="box box-primary">
                <div class="box-header">   </div>
                <div id="div_timeline" style="height: 800px;margin:20px" ></div>
            </div>



        </section><!-- /.content -->

    </aside><!-- /.right-side -->

    <style media="screen" type="text/css">

       .badge-OK {
           background-color: green;

       }
        .badge-UNKNOWN {
            background-color: #d3d3d3;

        }

        .badge-MISSING {
            background-color: #53424a;

        }

       .badge-WARNING {
           background-color: orange

       }

       .badge-CRITICAL{
           background-color:red;

       }




    </style>

    <script src="/resource/ARGO_UI/resources/js/jsapitimeline.js"></script>

    <script>
        <!--
        $(document).ready(function() {


                var newgroup = [];
                var colorsgroup = [];
                var links = [];


                var local_groups = document.getElementById('local_groups').getElementsByTagName('div');
                var local_links = document.getElementById('local_links').getElementsByTagName('div');


                for (j = 0; j < local_groups.length; j++) {

                    var tempArray = local_groups[j].textContent.split(",");
                    var color = tempArray.pop();

                    tempArray[4]= '<div class="panel panel-default">' +
                    '<div class="panel-heading"><div class="panel-title"><h3>'+ tempArray[0] +'</h3></div></div>'
                   + '<div class="panel-body">' +
                    '<label> Status: &nbsp;<span class="badge badge-'+tempArray[1].split("_")[0] +'">'+tempArray[1].split("_")[0] + '</span></label><hr/>' +
                    '<label>Start Time : &nbsp;</label>' + tempArray[2] + '<hr/>' +
                    '<label>End Time : &nbsp;</label>' + tempArray[3] + '</div></div>';

                    tempArray[2] = new Date(tempArray[2]);
                    tempArray[3] = new Date(tempArray[3]);

                    console.log(tempArray[4]);

                    newgroup.push(tempArray);
                    colorsgroup.push(color);

                }


           for (m = 0; m < local_links.length; m++) {
                    links.push(local_links[m].textContent);
                }

                google.setOnLoadCallback(drawChart);

                function drawChart() {
                    var container = document.getElementById('div_timeline');
                    var chart = new google.visualization.Timeline(container);

                    google.visualization.events.addListener(chart, 'select', function () {
                        var selectedItem = chart.getSelection()[0].row;
                        console.log(links[selectedItem]);
                        window.location = links[selectedItem];

                    });





                    var dataTable = new google.visualization.DataTable();
                    dataTable.addColumn({type: 'string', id: 'Service Flavour'});
                    dataTable.addColumn({type: 'string', id: 'Status'});
                    dataTable.addColumn({type: 'date', id: 'Start'});
                    dataTable.addColumn({type: 'date', id: 'End'});
                    dataTable.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});

                    dataTable.addRows(newgroup);

                    var options = {
                        title: 'Status report',
                        backgroundColor: '#fff',
                        colors : colorsgroup,
                        timeline: {
                            groupByRowLabel: true,
                            showBarLabels : false

                        }

                    };


                    function myHandler(e){
                        if(e.row != null){
                            $(".google-visualization-tooltip").html(dataTable.getValue(e.row,4)).css({width:"auto",height:"auto"});
                        }
                    }

                    google.visualization.events.addListener(chart, 'onmouseover', myHandler);

                    chart.draw(dataTable, options);
                }





        })




        -->
    </script>


</div>
</body>
</html>