<!DOCTYPE html>

<html  xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd"   xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd" tpl:extends="/lavoisier/_default_?accept=html">


<body>
<!-- Right side column. Contains the navbar and content of the page -->
<div id="wrapper">
    <aside class="right-side" id="right-side">
        <!-- Content Header (Page header) -->
        <section class="content-header" id="content-header">
            <h1>
                Recomputation
                <small>Management page</small>
            </h1>
            <ol class="breadcrumb" id="breadcrumb">
                <li ><a href="#"><i class="fa fa-dashboard"></i> Recomputation Management</a></li>
                <li class="active">Index</li>
            </ol>
        </section>

        <!-- Main content -->
        <section tpl:if="/root/@admin='true'" class="content" id="content">




            <!-- general form elements -->
                    <div  class="box box-primary col-md-6">
                        <div class="box-header">
                            <h3 class="box-title">Recomputation Form</h3>
                        </div><!-- /.box-header -->
                        <!-- form start -->
                        <form action="/lavoisier/form_recomputation_results?accept=html" method="post"  id="recomp_form">
                            <div class="box-body">

                                <div class="form-group">
                                    <label for="exampleInputPassword1">Name of the enquirer</label>
                                    <input name="requestor" type="name" class="form-control" id="exampleInputPassword1" placeholder="Enter the Name"/>
                                </div>



                                <div class="form-group">
                                    <label class="span1">Sites to be excluded from the computation</label>

                                    <select   class="form-control"  multiple="multiple"  id="listSites">
                                        <optgroup   tpl:foreach="/root/results/Ngi" label="{{@key}}">
                                            <option tpl:foreach="SITE" name="{{@NAME}}" value="{{@NAME}}">{{@NAME}}</option>
                                        </optgroup>
                                    </select>

                                </div>

                                <div  class="form-group">
                                    <label>Reason of the Recomputation</label>
                                    <textarea name="reason"    class="form-control" id="reason for recomputation">Explain the reason of the recomputation and eventually the details about the recomputation.
                                    </textarea>
                                </div>



                                <div class="form-group">

                                    <label for="profile">Profiles</label>

                                            <select name="profile" id="profile" class="form-control">
                                                <option tpl:foreach="/root/profile" value="{{concat(@namespace,'-',@name)}}">{{concat(@namespace,'-',@name)}}</option>
                                            </select>

                                </div>


                                <div  class="form-group">
                                    <label for="reportrange">Computation Period (UTC)</label>
                                    <input  class="form-control" type="text" name="period"  id="reportrange"/>
                                </div>


                            </div>

                            <div class="form-group hidden" >
                                <input name="listofSites" value="" class="form-control" id="listSitesP" />
                                <input name="profile" value="" id="Fprofile"/>
                            </div>


                            <input name="recompId" class="hidden" id="recompId" value=""/>

                            </form>



                        <div class="box-footer">
                            <button class="btn btn-primary" id="buttonSubmit" type="submit">Submit</button>
                        </div>
                        </div>




        </section><!-- /.content -->

        <section     tpl:else="" class="content" id="content">
            <div  class="box box-danger col-md-12">
                    <div clas="box-header">
                        <div clas="box-header">
                            <h4 class="box-title" tpl:foreach="/root">You haven't been recognized as administrator of the service .You are not authorized to ask this page.<br/>
                                <small >You need to ask the administrator role for the DN : {{@user}}</small> </h4>
                        </div>
                    </div>
            </div>
        </section>
    </aside><!-- /.right-side -->
</div>



</body>

<script src="/resource/ARGO_UI/resources/js/plugins/daterangepicker/daterangepicker.js" type="text/javascript"></script>

<script type="text/javascript" src="/resource/ARGO_UI/resources/js/multiselect.js"></script>
<script>


    $(document).ready(function ($) {
        $('#listSites').multiSelect({

                }
        );


        $('#reportrange').daterangepicker(
                {
                    timePicker: true,
                    format: 'YYYY-MM-DD HH:MM',
                    startDate: moment().subtract('days', 29),
                    endDate: moment()
                }

        );

        var availableNgis = "ALL" + $("#listNgi").text();
        var availableSites =  "ALL" + $("#listSite").text();
        var tabavailableNgis=  availableNgis.split(',');
        var tabavailableSite= availableSites.split(',');

        $("#filters-ngi").autocomplete({
            search:true,
            source: tabavailableNgis,
            TextHint : "Enter search or Double click to have the whole list"

        });

        $("#filters-site").autocomplete({
            source: tabavailableSite,
            autoFocus: true
        });



        $("#buttonSubmit").click(function(){



            var listSites="";

            $(".ms-selected >span").each(function( index ) {
                listSites=listSites + ',' +  $( this ).text() ;
            });

            $("#listSitesP").val(listSites);

            var profile=$('#profile :selected').val();

            $("#Fprofile").val(profile);

            $("#recompId").val(Date.now());

           $("#recomp_form").submit();

        });






    });



</script>

</html>