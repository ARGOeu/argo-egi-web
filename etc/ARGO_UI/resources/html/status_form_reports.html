<!DOCTYPE html>
<html xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd"
      xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd"
      tpl:extends="http://localhost:8080/lavoisier?accept=html"
      tpl:parameter.min=""
      tpl:parameter.max="">


<body>
<!-- Right side column. Contains the navbar and content of the page -->
<div id="wrapper">

<aside class="right-side" id="right-side">
    <!-- Content Header (Page header) -->
    <section class="content-header" id="content-header">
        <h1>
            Status Reports
            <small>Customized report</small>
            <button type="button" class="pull-right btn btn-primary" data-toggle="modal" data-target="#myHelp">
                <div class="fa fa-info"></div>
            </button>


        </h1>




        <div class="modal fade " id="myHelp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
                        <h3 class="modal-title" id="myModalLabel">Help  <i class="ion ion-clipboard"></i></h3>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li>Please select a predefined period , an entity or a combination of entities and a profile . </li>
                            <li>You can select only one level of entity : Operations Center, site or host</li>
                            <li>But you can filter site or Operations Center with a service type</li>
                            <li class="info-box-text">Then by clicking on the button you will generate the status report for these parameters</li>
                            <li class="info-box-text">The entity selection is working by auto-completion</li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>

                    </div>
                </div>
            </div>
        </div>

    </section>

    <!-- Main content -->
    <section class="content" id="content">
        <div id="id_content" class="hidden"></div>


        <form method="post" id="Statusform">

            <div class="box box-primary">

                <div class="row" style="margin:20px;padding:20px">

                    <div class="box  col-md-3" style="margin:20px;padding:20px;height:400px ">

                        <div class="box-header"><H3 class="box-title"> <label> <i class="fa fa-calendar"> </i>   Date range:</label></H3></div>
                        <div class="box-body">
                            <div class="range">


                                <!--<input  id="reportrange" type="text" /><span></span><br/>-->

                                <input type="radio" name="range" class="range" value="data_status_report_today" checked="true"/> Today <br/>
                                <input type="radio" name="range" class="range"  value="data_status_report_last_day"/> Previous day<br/>
                                <input type="radio" name="range" class="range"  value="data_status_report_lastweek"/> Last 7 days<br/>
                                <input type="radio" name="range" class="range"  value="data_status_report_lastmonth"/> Last 30 days<br/>
                                <input type="radio" name="range" class="range" value="data_status_report_3lastmonth"/> Last 3 months<br/>
                            </div><!-- /.input group -->
                            </div>


                        </div>




                    <div class="box  col-md-3 " style="margin:20px;padding:20px;height:400px">

                        <div class="box-header"><H3 class="box-title"> <label> <i class="fa fa-globe"> </i>   Entity :</label></H3></div>

                        <div class="box-body">

                            <div class="form-group ">



                                <label>OPERATIONS CENTER</label>
                                <input type="text" style="margin-left:20px" name="ngi" id="filters-ngi" placeholder="Enter Search " /><br/>




                                <label>SITE </label>
                                <input type="text" style="margin-left:20px" name="site" id="filters-site" placeholder="Enter Search " /><br/>


                                <label>SERVICE TYPE </label>

                                <input type="text" style="margin-left:20px" name="sf" id="filters-sf" placeholder="Enter Search "/><br/>




                                <label>HOST </label>
                                <input type="text" style="margin-left:20px" name="host" id="filters-host" placeholder="Enter Search "/>


                            </div>
                        </div>
                    </div>



                    <div class="box  col-md-3 " style="margin:20px;padding:20px;height:400px">

                        <div class="box-header"><H3 class="box-title"><i class="fa fa-group"> </i>  Profiles</H3></div>

                        <div class="box-body">

                            <div class="form-group profile">


                                <input  tpl:foreach="/root/profile" tpl:with-order="@namespace" type="radio" class="profile" name="profile" value="{{concat(@namespace,'-',@name)}}" checked="true"> {{concat(@namespace,'-',@name)}} <br/></input>



                            </div>
                        </div>
                    </div>



                </div>



                <div class="row" style="margin:30px;padding:20px">
                    <input class="btn btn-primary offset1" id="buttonAR" value="Generate Reports"/>
                </div>

            </div>




            <div class="hidden" id="listNgi" tpl:foreach="/root/ngis">{{text()}}</div>
            <div class="hidden" id="listSite" tpl:foreach="/root/sites">{{text()}}</div>
            <div  id="listHost"  class="hidden"  tpl:foreach="/root/hosts">{{text()}}</div>

            <div    id="listSf" class="hidden">
                <div tpl:foreach="root/profile/AND/OR/Group">{{@service_flavor}}</div>
                </div>

            <!--<input class="hidden" name="site" if="listsites" value=""/>-->
            <!--<input class="hidden" name="ngi" if="listngi" value=""/>-->

        <script src="/resource/ARGO_UI/resources/js/plugins/daterangepicker/daterangepicker.js" type="text/javascript"></script>


        <script>
<!--

                function split( val ) {
                    return val.split( /,\s*/ );
                }
                function extractLast( term ) {
                    return split( term ).pop();
                }


            $(document).ready(function ($) {






                // Variable initialisation for the autocomplete
                var availableNgis =  $("#listNgi").text();
                var availableSites =   $("#listSite").text();
                var availableHosts =   $("#listHost").text();



                // #####################################
                // Build a table of mapping host - sites , host - ngi
                // #####################################


                var tabavailableNgis=  availableNgis.split(',');
                var tabavailableSite= availableSites.split(',');
                var tabavailableHost= availableHosts.split(',');
                tabavailableHost.shift();

                var tabavailableHostNgi= [];
                var tabavailableHostSite= [];
                var tabavailableHostList= [];
                var tabavailableHostHost= [];
                var tabavailableHostSf= [];
                var tabavailableSf= [];

                $.each(tabavailableHost, function( index, value ) {

                    var tabsHost = value.split('___');

                    tabavailableHostNgi[tabsHost[2] + ' (' + tabsHost[3] + ')'] = tabsHost[0];
                    tabavailableHostSite[tabsHost[2] + ' (' + tabsHost[3] + ')'] = tabsHost[1];
                    tabavailableHostHost[tabsHost[2] + ' (' + tabsHost[3] + ')'] = tabsHost[2];
                    tabavailableHostList.push(tabsHost[2] + ' (' + tabsHost[3] + ')');
                    tabavailableHostSf[tabsHost[2] + ' (' + tabsHost[3] + ')'] = tabsHost[3];

                });


                // Build the service flavour List
                var divSf= document.getElementById('listSf').getElementsByTagName('div');

                for (i=0; i<divSf.length; i++) {
                    tabavailableSf.push(divSf[i].textContent);
                }


                //  ################################
                //  Autocompletion fonctions
                // ##############################


                // call the autocomplete functions
                // Add eventually (sites , host ) the possibility to select multiple values and concatenate it

                $("#filters-ngi").autocomplete({
                    search:true,
                    source: tabavailableNgis,
                    TextHint : "Enter search or Double click to have the whole list"

                });

                $("#filters-site").autocomplete({

                    source: function( request, response ) {
                        // delegate back to autocomplete, but extract the last term
                        response( $.ui.autocomplete.filter(
                                tabavailableSite, extractLast( request.term ) ) );
                    },
                    focus: function() {
                        // prevent value inserted on focus
                        return false;
                    },
                    select: function( event, ui ) {
                        var terms = split( this.value );
                        // remove the current input
                        terms.pop();
                        // add the selected item
                        terms.push( ui.item.value );
                        // add placeholder to get the comma-and-space at the end
                        terms.push( "" );
                        this.value = terms.join( ", " );
                        return false;
                    }
                });





                $("#filters-host").autocomplete({

                    source: function( request, response ) {
                        // delegate back to autocomplete, but extract the last term
                        response( $.ui.autocomplete.filter(
                                tabavailableHostList, extractLast( request.term ) ) );
                    },
                    focus: function() {
                        // prevent value inserted on focus
                        return false;
                    },
                    select: function( event, ui ) {
                        var terms = split( this.value );
                        // remove the current input
                        terms.pop();
                        // add the selected item
                        terms.push( ui.item.value );
                        // add placeholder to get the comma-and-space at the end
                        terms.push( "" );
                        this.value = terms.join( ", " );
                        return false;
                    }
                });

                $("#filters-sf").autocomplete({


                    source: function( request, response ) {
                        // delegate back to autocomplete, but extract the last term
                        response( $.ui.autocomplete.filter(
                                tabavailableSf, extractLast( request.term ) ) );
                    },
                    focus: function() {
                        // prevent value inserted on focus
                        return false;
                    },
                    select: function( event, ui ) {
                        var terms = split( this.value );
                        // remove the current input
                        terms.pop();
                        // add the selected item
                        terms.push( ui.item.value );
                        // add placeholder to get the comma-and-space at the end
                        terms.push( "" );
                        this.value = terms.join( ", " );
                        return false;
                    }
                });






                        // #######################
                        // Treatment of the form
                        // ####################


                $("#buttonAR").click(function () {



                    var FormValid=true;

                 // NGI or Site should be filled
                    if ( ($('input[id=filters-ngi]').val()  && $('input[id=filters-site]').val() && $('input[id=filters-host]').val()) || ($('input[id=filters-ngi]').val() == '' && $('input[id=filters-site]').val() == '' && $('input[id=filters-host]').val() == '' ) )
                    {
                        alert("Please select a NGI Name OR a site Or a Host");
                       FormValid=false;
                   }





                    if (FormValid==true)
                    {


                        var view='site_status_report?';

                        if ($('input[id=filters-sf]').val()!='') {
                            view= 'sitesf_status_report?';

                        }







                        var range = $( ".range input:checked" ).val();
                        var profile = $( ".profile input:checked" ).val();

                        if (profile.search('cloud') > 1 ) {
                            range = range + '_cloud';
                        }





                        var ListSites = ""
                        var ListHost="";
                        var ListSf="";


                        if ($('input[id=filters-host]').val()) {

                            view = 'metric_status_report?';

                            var tabHosts=$('input[id=filters-host]').val().split(',');
                            tabHosts.pop();

                            $.each(tabHosts, function( index, value ) {

                                    if (tabavailableHostSite[value.trim()]!='undefined')
                                        ListSites = ListSites + "," + tabavailableHostSite[value.trim()];
                                    if (tabavailableHostHost[value.trim()]!='undefined')
                                        ListHost = ListHost + "," + tabavailableHostHost[value.trim()];

                                if (tabavailableHostSf[value.trim()]!='undefined')
                                    ListSf = ListSf + "," + tabavailableHostSf[value.trim()];

                                });
                            $('input[id=filters-host]').val(ListHost);
                            $('input[id=filters-site]').val(ListSites);
                            $('input[id=filters-sf]').val(ListSf);

                        }







                        var link ='/lavoisier/'  + view  + '&data=' + range +  '&accept=html' ;

                        $('#Statusform').get(0).setAttribute('action', link);
                        $('#Statusform').submit();

                    }

                });





            });



-->

        </script>

        </form>
    </section>
    <!-- /.content -->

</aside>
<!-- /.right-side -->


</div>
</body>

<style type="text/css">
    .form-group label {
        margin-left:10px;
        width : 100px;

    }

</style>

</html>

