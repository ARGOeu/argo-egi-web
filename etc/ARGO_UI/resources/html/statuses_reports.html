<!DOCTYPE html>
<html  xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd"
       xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd"
       tpl:extends="http://localhost:8080/lavoisier/_default_?accept=html">

<body>
<!-- Right side column. Contains the navbar and content of the page -->
<div id="wrapper">

    <aside tpl:if="/e:entries/e:entry/Site" class="left-side" id="left-side">
        <section class="sidebar">
            <ul class="sidebar-menu" style="list-style:none;">

                <li tpl:foreach="/e:entries/e:entry" style="padding-left:20px;">
                    <a   href="#{{@key}}" >
                        <i class="fa fa-angle-double-left" style="padding:5px"> </i>
                        <span> {{@key}} </span>
                        <i class="fa fa-angle-double-right" style="padding:5px"> </i>

                    </a>


                </li>


            </ul>
        </section>
    </aside>

    <aside class="right-side" id="right-side">
        <!-- Content Header (Page header) -->
        <section class="content-header" id="content-header">
            <h1>
               Status Reports
                <small>Click on individual bar to access details</small>

            </h1>


        </section>

        <!-- Main content -->
        <section class="content" id="content" tpl:if="count(/root/group) + count(/root/group/group_ts) &gt; 0">



            <div  id="local_groups" style="display: none">
                <div tpl:foreach="/root/group/group/group_ts" >{{ancestor::group/@name}},{{@value}}_{{position()}},{{@timestamp}},{{@endtime}},{{@color}}</div>
            </div>



            <div  id="local_links" tpl:if="not(/root/group/group/group_ts/@url)" style="display: none">
                <div tpl:foreach="/root/group/group/group_ts" >/lavoisier/{{ancestor::group[@view]/@view}}?{{ancestor::group[@entity]/@entity}}={{ancestor::group/@name}}&amp;accept=html</div>
            </div>
            <div id="local_links" tpl:else="" style="display: none">
                <div  tpl:foreach="/root/group/group/group_ts" >/lavoisier/{{@url}}</div>


            </div>




            <div tpl:if="not(contains(/root/group/@entity,'report=cloud') and (/root/group/@view='sf_status'))"  class="box box-primary">

                    <div tpl:foreach="/root/group" style="margin:20px" class="title">
                    <span > <a href="/lavoisier/choiceNgi?accept=html">EGI </a></span>
                    <span tpl:if="@ngi"><a href="/lavoisier/site_status?ngi={{@ngi}}&amp;accept=html">&gt;{{@ngi}}</a>  </span>
                    <span tpl:if="@site"><a href="/lavoisier/site_status?ngi={{@ngi}}&amp;site={{@site}}&amp;accept=html"> &gt; {{@site}} </a> </span>
                    <span tpl:if="@sf"><a href="/lavoisier/host_status?ngi={{@ngi}}&amp;site={{@site}}&amp;sf={{@sf}}&amp;accept=html"> &gt; {{@sf}} </a> </span>
                    <span tpl:if="@host"><a href="/lavoisier/metric_status?ngi={{@ngi}}&amp;site={{@site}}&amp;sf={{@sf}}&amp;host={{@host}}&amp;accept=html"> &gt; {{@host}} </a> </span>
                        <div tpl:foreach="/root/group" style="margin:20px" class="pull-right">
                            <span class="label label-primary">{{@start_time}} </span>  <span class="label label-primary" style="margin-left:15px">{{@end_time}}</span>
                        </div>

                    </div>

                    <div id="div_timeline" style="height: 800px;margin:20px" ></div>

            </div>


            <div tpl:else="" class="box box-primary">

                <div tpl:foreach="/root" style="margin:20px" class="title">
                    <span >EGI ></span>
                    <span > <a href="/lavoisier/site_status?report=cloud&amp;ngi=all&amp;accept=html">EGI Federated Cloud</a></span>



                </div>

                <div id="div_timeline" style="height: 1200px;margin:20px" ></div>

            </div>





        </section><!-- /.content -->

        <section class="content" id="content" tpl:else="">
            <div class="alert alert-info">No data for the selection and period . </div>

            </section>

    </aside><!-- /.right-side -->

    <style media="screen" type="text/css">

        .badge-OK {
            background-color: green;

        }
        .badge-UNKNOWN {
            background-color: #d3d3d3;

        }

        .badge-MISSING {
            background-color: #53424a;

        }

        .badge-WARNING {
            background-color: orange

        }

        .badge-CRITICAL{
            background-color:red;

        }




    </style>

    <script src="/resource/ARGO_UI/resources/js/jsapitimeline.js"></script>

    <script>
        <!--
        $(document).ready(function() {


            var newgroup = [];
            var colorsgroup = [];
            var links = [];


            var local_groups = document.getElementById('local_groups').getElementsByTagName('div');
            var local_links = document.getElementById('local_links').getElementsByTagName('div');


            for (j = 0; j < local_groups.length; j++) {

                var tempArray = local_groups[j].textContent.split(",");
                var color = tempArray.pop();

                tempArray[4]= '<div class="panel panel-default">' +
                '<div class="panel-heading"><div class="panel-title"><h3>'+ tempArray[0] +'</h3></div></div>'
                + '<div class="panel-body">' +
                '<label> Status: &nbsp;<span class="badge badge-'+tempArray[1].split("_")[0] +'">'+tempArray[1].split("_")[0] + '</span></label><hr/>' +
                '<label>Start Time : &nbsp;</label>' + tempArray[2] + '<hr/>' +
                '<label>End Time : &nbsp;</label>' + tempArray[3] + '</div><div class="panel-footer"><em>Click on the bar to access the next granularity level</em></div></div>';

                tempArray[2] = new Date(tempArray[2]);
                tempArray[3] = new Date(tempArray[3]);


                newgroup.push(tempArray);
                colorsgroup.push(color);

            }


            for (m = 0; m < local_links.length; m++) {
                links.push(local_links[m].textContent);
            }

            google.setOnLoadCallback(drawChart);

            function drawChart() {
                var container = document.getElementById('div_timeline');
                var chart = new google.visualization.Timeline(container);

                google.visualization.events.addListener(chart, 'select', function () {
                    var selectedItem = chart.getSelection()[0].row;
                    window.location = links[selectedItem];

                });





                var dataTable = new google.visualization.DataTable();
                dataTable.addColumn({type: 'string', id: 'Service Flavour'});
                dataTable.addColumn({type: 'string', id: 'Status'});
                dataTable.addColumn({type: 'date', id: 'Start'});
                dataTable.addColumn({type: 'date', id: 'End'});
                dataTable.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});

                dataTable.addRows(newgroup);

                var options = {
                    title: 'Status report',
                    backgroundColor: '#fff',
                    colors : colorsgroup,
                    timeline: {
                        groupByRowLabel: true,
                        showBarLabels : false

                    }

                };


                function myHandler(e){
                    if(e.row != null){
                        $(".google-visualization-tooltip").html(dataTable.getValue(e.row,4)).css({width:"auto",height:"auto"});
                    }
                }

                google.visualization.events.addListener(chart, 'onmouseover', myHandler);

                chart.draw(dataTable, options);
            }





        })




        -->
    </script>


</div>
</body>
</html>