<!DOCTYPE html>
<html xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd" tpl:extends="http://localhost:8080/lavoisier?accept=html">

<body>
<!-- Right side column. Contains the navbar and content of the page -->
<div id="wrapper">
<aside class="right-side" id="right-side">
    <!-- Content Header (Page header) -->
    <section class="content-header" id="content-header">
        <h1>
            Profiles
            <small>Creation page</small>
        </h1>
        <ol class="breadcrumb" id="breadcrumb">
            <li ><a href="#"><i class="fa fa-dashboard"></i> Profile Creation</a></li>
            <li class="active">Index</li>
        </ol>
    </section>


    <!-- Main content -->
    <section class="content" id="content" tpl:if="/results/@admin='true'">>

        <form role="form"  style="margin:50px" method="post" action="/lavoisier/post_profile?accept=json" id="form_profile">

            <div class="row">
            <div class="col-xs-8 box box-primary">
                <div class="box-header">
                    <h3 class="box-title">Profile References</h3>
                </div>
                <div class="form-group">
                    <label for="profileName">Name of the Profile</label>
                    <input type="text" class="form-control" name="profileName" id="profileName" placeholder="Profile Name"/>
                </div>
                <div class="form-group">
                    <label for="profileNameSpace">NameSpace of the Profile</label>
                    <input type="text" class="form-control" name="profileNameSpace" id="profileNameSpace" placeholder="Profile Name Space"/>
                </div>
                <div class="form-group">
                    <label>POEM Profile</label>
                    <input type="text" class="form-control" name="profilePoem" id="profilePoem" placeholder="POEM Profile"/>
                </div>

             </div>
                </div>

    <div class="row">

                <div class="col-xs-8 box box-primary">


                    <div class="box-header">
                         <h3 class="box-title">Service Flavours</h3>
                        <em class="pull-right"> Compose a group with the service Flavours then add it to the profile</em>
                    </div>

                    <div class="box-content">


                        <div class="form-group">

                                    <select  multiple="multiple"  id="listServices">
                                        <option tpl:foreach="/results/SERVICE_TYPE/SERVICE_TYPE_NAME" name="{{text()}}" value="{{text()}}">{{text()}}</option>
                                    </select>

                            <div id="add_list"  class="btn btn-primary pull-right">
                                <i style="margin:5px" class="fa fa-plus-circle"> </i> ADD
                            </div>

                        </div>

                    </div>

                </div>



        </div>

        <div class="row">

        <div class="box box-primary"  id="div_add_list" style="display:none">

            <div class="box-header">
                <h3 class="box-title">Profile</h3>
                <em class="pull-right"> Compose a profile with a combination of groups then validate</em>
            </div>


            <div class="box-content">

                <div  id="listProfile" style="height:400px;overflow:auto"></div>
            </div>

            <div class="form-group">

                <input style="margin:5px"  type="submit" class="btn btn-primary " value="submit"/>
            </div>



        </div>

        </div>



        <input type="text" class="hidden" id="profile_input"/>
        <div id="newGroup"  style="min-height:90px" class="hidden"/>
        <div id="separator"  class="hidden"><code>AND</code> </div>
        <button id="removeId" onclick="javascript:closeGroup(this.id)" class="btn btn-primary fa fa-times-circle" style="display:none;"></button>

</form>

    </section><!-- /.content -->

    <section     tpl:else="" class="content" id="content">
        <div  class="box box-danger col-md-12">
            <div clas="box-header">
                <h4 class="box-title" tpl:foreach="/root">You haven't been recognized as administrator of the service .You are not authorized to ask this page.<br/>
                You need to ask the administrator role for the DN : {{@user}} </h4>
            </div>
        </div>
    </section>
</aside><!-- /.right-side -->
</div>
</body>

<style>

    .group {
        height:180px;
        overflow: auto;

    }

</style>

<script type="text/javascript" src="/resource/ARGO_UI/resources/js/multiselect.js"></script>

<script type="text/javascript" >

    var grp_cpt=0;

    function closeGroup(closeGroupId)
    {
        var closeId=closeGroupId.substring(6);


        $("#"+closeId).remove();
        $("#separator_"+closeId).remove();

    }


    $( document ).ready(function(){



        $('#listServices').change(function(){

            if( ($('.ms-selection > .ms-list > li:visible').length) )
                $("#div_add_list").css("display","block");
        });

        $('#listServices').multiSelect({

                }
        );




        $("#add_list").click(function(){

            grp_cpt=grp_cpt+1;

            var newId = 'group'+ grp_cpt;
            var newcloseId = 'close_group'+ grp_cpt;
            var profileId = 'profile'+ grp_cpt;
            var newseparatorId = 'separator_group'+ grp_cpt;
            var textIn= '';

            $("#newGroup").clone().appendTo('#listProfile');

            $("#listProfile > #newGroup").attr("id",newId);
            var title=  newId ;

            $("#" + newId).attr("class","col-xs-3 box group");


            $("#removeId").clone().appendTo("#" + newId);


            $("#" + newId +  "> #removeId").css("display","block");
            $("#" + newId + "> #removeId").attr("id",newcloseId);


            $(".ms-selection > .ms-list").clone().appendTo('#' + newId);


            $("#" + newId +"> .ms-list  > li:visible > span").each(function( index ) {
                textIn =  $(this).text() + ',' +  textIn ;

            });

            $("#profile_input").clone().appendTo('#listProfile');
            $("#listProfile > #profile_input").attr("value",textIn);
            $("#listProfile > #profile_input").attr("name",newId);
            $("#listProfile > #profile_input").attr("id", profileId);

            $("#separator").clone().appendTo('#listProfile');
            $("#listProfile > #separator").attr("class","col-xs-1");
            $("#listProfile > #separator").attr("id",newseparatorId );

            $(".ms-selection > .ms-list  > li").css("display","none");
            $(".ms-selectable > .ms-list  > li").css("display","block");

            $("#div_add_profile").css("display","block");


        });


        $("#buttonSubmit").click(function(){

            $("#form_profile").submit();

        });





    });
</script>

</html>