<!DOCTYPE html>
<html  xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd"
       xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd"
       tpl:extends="http://localhost:8080/lavoisier/_default_?accept=html">

<body>
<!-- Right side column. Contains the navbar and content of the page -->
<div id="wrapper">

    <aside class="right-side" id="right-side">
        <!-- Content Header (Page header) -->
        <section class="content-header" id="content-header">
            <h1>
                Status Reports
                <small>Click on individual bar to access details</small>

            </h1>


        </section>

        <!-- Main content -->
        <section class="content" id="content">

            <div  id="local_groups" class="hidden" >

                <div tpl:foreach="/e:entries/e:entry/Ngi" >{{@NGI}},{{ancestor::e:entries/@month1}},{{ancestor::e:entries/@month2}},{{Availability[@timestamp=ancestor::e:entries/@month1]/@color_av}},{{Availability[@timestamp=ancestor::e:entries/@month1]/@availability}}
                </div>

                <div tpl:foreach="/e:entries/e:entry/Ngi" >{{@NGI}},{{ancestor::e:entries/@month2}},{{ancestor::e:entries/@month3}},{{Availability[@timestamp=ancestor::e:entries/@month2]/@color_av}},{{Availability[@timestamp=ancestor::e:entries/@month2]/@availability}}</div>

                <div tpl:foreach="/e:entries/e:entry/Ngi" >{{@NGI}},{{ancestor::e:entries/@month3}},{{ancestor::e:entries/@month4}},{{Availability[@timestamp=ancestor::e:entries/@month3]/@color_av}},{{Availability[@timestamp=ancestor::e:entries/@month3]/@availability}}</div>


            </div>

            <div id="div_timeline" style="height: 800px;margin:20px" ></div>

        </section><!-- /.content -->
    </aside><!-- /.right-side -->



    <script src="/resource/ARGO_UI/resources/js/jsapitimeline.js"></script>

    <script>
        <!--
        $(document).ready(function() {


            var newgroup = [];
            var colorsgroup = [];
            var links = [];


            var local_groups = document.getElementById('local_groups').getElementsByTagName('div');



            for (j = 0; j < local_groups.length; j++) {

                var tempArray = local_groups[j].textContent.split(",");
                var color = tempArray.pop();

//                tempArray[4]= '<div class="panel panel-default">' +
//                                    '<div class="panel-heading">' +
//                                            '<div class="panel-title"><h3>'+ tempArray[0] +
//                            '</h3></div></div>' +
//                        '<div class="panel-body">' +
//                        '<label>Availability:</label>' + tempArray[3] +
//                        '<label>Month : &nbsp;</label>' + tempArray[1] + '<hr/>' +
//                        '</div></div>';
                tempArray[4]=tempArray[0];
                tempArray[1] = new Date(tempArray[1].substring(0,4),tempArray[1].substring(5,7),1);
                tempArray[2] = new Date(tempArray[2].substring(0,4),tempArray[2].substring(5,7),1);


                newgroup.push(tempArray);
                colorsgroup.push(color);

            }


            google.setOnLoadCallback(drawChart);

            function drawChart() {
                var container = document.getElementById('div_timeline');
                var chart = new google.visualization.Timeline(container);

                google.visualization.events.addListener(chart, 'select', function () {
                    var selectedItem = chart.getSelection()[0].row;
                    window.location = links[selectedItem];

                });





                var dataTable = new google.visualization.DataTable();
                dataTable.addColumn({type: 'string', id: 'Service Flavour'});
                dataTable.addColumn({type: 'string', id: 'Status'});
                dataTable.addColumn({type: 'date', id: 'Start'});
                dataTable.addColumn({type: 'date', id: 'End'});
                dataTable.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});

                dataTable.addRows(newgroup);

                var options = {
                    title: 'Status report',
                    backgroundColor: '#fff',
                    colors : colorsgroup,
                    timeline: {
                        groupByRowLabel: true,
                        showBarLabels : false

                    }

                };


                function myHandler(e){
                    if(e.row != null){
                        $(".google-visualization-tooltip").html(dataTable.getValue(e.row,4)).css({width:"auto",height:"auto"});
                    }
                }

                google.visualization.events.addListener(chart, 'onmouseover', myHandler);

                chart.draw(dataTable, options);
            }





        })




        -->
    </script>
</div>
</body>
</html>