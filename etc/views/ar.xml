<config xmlns="http://software.in2p3.fr/lavoisier/config.xsd" xmlns:date="http://exslt.org/dates-and-times" xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd">




    <view name="ngi_ar">
        <info>
            <category>AR reports</category>
            <description>NGI Customized Reports</description>
        </info>

        <argument name="ngi">any</argument>
        <argument name="granularity"/>
        <argument name="month">1970-01</argument>

        <argument name="monthend" eval="choose($month!='1970-01',substring(date:add($month,'P1M'),0,8))"/>
        <argument name="start_date" eval="choose($month!='1970-01',concat($month,'-01'))"/>
        <argument name="end_date" eval="choose($month!='1970-01',concat($monthend,'-01'))"/>

        <argument name="report">Critical</argument>
        <argument name="view_details">ar-site</argument>
        <argument name="cr">0</argument>

        <connector type="XMLConnector">

            <parameter name="content" eval="              view(choose($cr,'api.availability.call','api.availability.rotating.caches'),             entry('granularity',$granularity)             | entry('report',$report)             | entry('group_type','ngi')             | entry('start_time',concat($start_date,'T00:00:00Z'))             | entry('end_time',concat($end_date,'T00:00:00Z'))             )"/>
        </connector>



        <processors>


            <element in="root" out="e:entries">

                <attribute-create out="start_date">$start_date</attribute-create>
                <attribute-create out="end_date">$end_date</attribute-create>
                

                <attribute-create out="month">$month</attribute-create>
                <attribute-create out="report">$report</attribute-create>
                <attribute-create out="view">ngi_ar</attribute-create>
                <attribute-create out="view_details">$view_details</attribute-create>

                <element in="group" if="@name=$ngi or $ngi='any'" out="Entity">
                    <attribute-create out="NGI">../@name</attribute-create>
                    <element in="results" out="Availability"/>

                </element>
                <element-ignore/>
            </element>


            <elements path="e:entries/Entity">
                <element-ignore in="Availability" if="date:seconds(@timestamp) &lt; ancestor::e:entries/@start_timestamp"/>
                <element-ignore in="Availability" if="date:seconds(@timestamp) &gt; ancestor::e:entries/@end_timestamp"/>

            </elements>

            <element in="e:entries">

                <attribute-create out="status_url">concat('/status-site','?report=',$report,
                    '&amp;end=',$end_date,'&amp;start=',$start_date,'&amp;accept=html&amp;ngi=')
                </attribute-create>
            </element>





        </processors>

        <pre-renderers><namespace prefix="date" uri="http://exslt.org/dates-and-times"/><namespace prefix="e" uri="http://software.in2p3.fr/lavoisier/entries.xsd"/>
            <title>'Availabilities Reliabilities Chart'</title>
            <row foreach="/e:entries/Entity/Availability">
                <column label="entity">ancestor::Entity/@name</column>
                <column label="timestamp">@timestamp</column>
                <column unit="percentage" label="availability">format-number(@availability,'#.00')</column>
                <column unit="percentage" label="reliability">format-number(@reliability,'#.00')</column>
            </row>
        </pre-renderers>
        <renderers>

            <renderer type="DefaultRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="ChartRenderer">
                <parameter name="options">
                    <entry key="rotation">-45</entry>
                </parameter>
            </renderer>
        </renderers>


    </view>

    <view name="opsmon_ar">
        <info>
            <category>AR reports</category>
            <description>CloudCustomized Reports</description>
        </info>
        <argument name="site"/>
        <argument name="ngi">false</argument>
        <argument name="granularity"/>
        <argument name="month">1970-01</argument>
        <argument name="monthend" eval="choose($month!='1970-01',substring(date:add($month,'P1M'),0,8))"/>
        <argument name="start_date" eval="choose($month!='1970-01',concat($month,'-01'))"/>
        <argument name="end_date" eval="choose($month!='1970-01',concat($monthend,'-01'))"/>
        <argument name="view_details">ar-service</argument>
        <argument name="report">OPS-MONITOR-Critical</argument>



        <connector type="XMLConnector">
            <parameter name="content" eval="view('site_ar',arguments())"/>
        </connector>

        <processors>
            <element in="e:entries">
                <attribute-create out="report">$report</attribute-create>
            </element>
        </processors>

        <pre-renderers><namespace prefix="date" uri="http://exslt.org/dates-and-times"/><namespace prefix="e" uri="http://software.in2p3.fr/lavoisier/entries.xsd"/>
            <title>'Availabilities Reliabilities Chart'</title>
            <row foreach="/e:entries/Entity/Availability">
                <column label="entity">ancestor::Entity/@name</column>
                <column label="timestamp">@timestamp</column>
                <column unit="percentage" label="availability">format-number(@availability,'#.00')</column>
                <column unit="percentage" label="reliability">format-number(@reliability,'#.00')</column>
                <column unit="percentage" label="unknown">format-number(@unknown,'#.00')</column>
                <column unit="percentage" label="downtime">format-number(@downtime,'#.00')</column>
            </row>
        </pre-renderers>
        <renderers>

            <renderer type="DefaultRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="ChartRenderer">
                <parameter name="options">
                    <entry key="rotation">-45</entry>
                </parameter>
            </renderer>
        </renderers>
    </view>


    <view name="fedcloud_ar">
        <info>
            <category>AR reports</category>
            <description>CloudCustomized Reports</description>
        </info>
        <argument name="site"/>
        <argument name="ngi">false</argument>
        <argument name="granularity"/>
        <argument name="month">1970-01</argument>
        <argument name="monthend" eval="choose($month!='1970-01',substring(date:add($month,'P1M'),0,8))"/>
        <argument name="start_date" eval="choose($month!='1970-01',concat($month,'-01'))"/>
        <argument name="end_date" eval="choose($month!='1970-01',concat($monthend,'-01'))"/>
        <argument name="view_details">ar-service</argument>
        <argument name="poems">ch.cern.sam.CLOUD-MON_CRITICAL</argument>
        <argument name="report">Fedcloud</argument>



        <connector type="XMLConnector">
            <parameter name="content" eval="view('site_ar',arguments())"/>
        </connector>




        <pre-renderers><namespace prefix="date" uri="http://exslt.org/dates-and-times"/><namespace prefix="e" uri="http://software.in2p3.fr/lavoisier/entries.xsd"/>
            <title>'Availabilities Reliabilities Chart'</title>
            <row foreach="/e:entries/Entity/Availability">
                <column label="entity">ancestor::Entity/@name</column>
                <column label="timestamp">@timestamp</column>
                <column unit="percentage" label="availability">format-number(@availability,'#.00')</column>
                <column unit="percentage" label="reliability">format-number(@reliability,'#.00')</column>
            </row>
        </pre-renderers>
        <renderers>

            <renderer type="DefaultRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="ChartRenderer">
                <parameter name="options">
                    <entry key="rotation">-45</entry>
                </parameter>
            </renderer>
        </renderers>
    </view>



    <view name="cloud_ar">
        <info>
            <category>AR reports</category>
            <description>CloudCustomized Reports</description>
        </info>
        <argument name="site"/>
        <argument name="ngi">false</argument>
        <argument name="granularity"/>
        <argument name="month">1970-01</argument>
        <argument name="monthend" eval="choose($month!='1970-01',substring(date:add($month,'P1M'),0,8))"/>
        <argument name="start_date" eval="choose($month!='1970-01',concat($month,'-01'))"/>
        <argument name="end_date" eval="choose($month!='1970-01',concat($monthend,'-01'))"/>
        <argument name="view_details">ar-service</argument>
        <argument name="poems">ch.cern.sam.CLOUD-MON_CRITICAL</argument>
        <argument name="report">Cloud</argument>



        <connector type="XMLConnector">
            <parameter name="content" eval="view('site_ar',arguments())"/>
        </connector>




        <pre-renderers><namespace prefix="date" uri="http://exslt.org/dates-and-times"/><namespace prefix="e" uri="http://software.in2p3.fr/lavoisier/entries.xsd"/>
            <title>'Availabilities Reliabilities Chart'</title>
            <row foreach="/e:entries/Entity/Availability">
                <column label="entity">ancestor::Entity/@name</column>
                <column label="timestamp">@timestamp</column>
                <column unit="percentage" label="availability">format-number(@availability,'#.00')</column>
                <column unit="percentage" label="reliability">format-number(@reliability,'#.00')</column>
            </row>
        </pre-renderers>
        <renderers>

            <renderer type="DefaultRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="ChartRenderer">
                <parameter name="options">
                    <entry key="rotation">-45</entry>
                </parameter>
            </renderer>
        </renderers>
    </view>

    <view name="site_ar">
        <info>
            <category>AR reports</category>
            <description>Site Customized Reports</description>
        </info>
        <argument name="site"/>
        <argument name="ngi">false</argument>
        <argument name="granularity"/>

        <argument name="month">1970-01</argument>
        <argument name="monthend" eval="choose($month!='1970-01',substring(date:add($month,'P1M'),0,8))"/>

        <argument name="start_date" eval="choose($month='1970-01','_DATE_',concat($month,'-01'))"/>
        <argument name="end_date" eval="choose($month='1970-01','_DATE_',concat($monthend,'-01'))"/>



        <argument name="view_details">ar-service</argument>
        <argument name="poems">ch.cern.sam.ROC_CRITICAL</argument>
        <argument name="report">Critical</argument>
        <variable name="start_time" eval="choose($start_date!='_DATE_',concat($start_date,'T00:00:00Z'),concat(substring(date:add(date:date-time(),'-P30D'), 0,11),'T00:00:00Z'))"/>
        <variable name="end_time" eval="choose($end_date!='_DATE_',concat($end_date,'T00:00:00Z'),concat(substring(date:add(date:date-time(),'-P1D'), 0,11),'T00:00:00Z'))"/>


        <connector type="XMLConnector">

            <parameter name="content" eval="view('api.availability.rotating.caches',             entry('granularity',$granularity)             | entry('report',$report)             | entry('group_type','sites')             | entry('start_time',$start_time)             | entry('end_time',$end_time)             )"/>
        </connector>

        <processors>

            <element in="root" out="e:entries">

                <attribute-create out="start_timestamp">date:seconds($start_time)</attribute-create>
                <attribute-create out="end_timestamp">date:seconds($end_time)</attribute-create>

                <attribute-create out="start_date">$start_time</attribute-create>
                <attribute-create out="end_date">$end_time</attribute-create>

                <attribute-create out="view">site_ar</attribute-create>
                <attribute-create out="view_details">$view_details</attribute-create>
                <attribute-create out="report">$report</attribute-create>

                <element in="group" if="@name=$ngi or $ngi='false'">
                    <element in="group" out="Site" if="contains(concat($site,','),@name) or $ngi!='false'">
                        <element in="results" out="Availability"/>
                    </element>
                </element>
                <element-ignore/>
            </element>

            <element in="e:entries">
                <element-ignore in="group">

                    <element in="Site" out="Entity">
                        <attribute-create out="NGI">../ancestor::group/@name</attribute-create>
                    </element>
                </element-ignore>
            </element>


            <elements path="e:entries/Entity">
                <element-ignore in="Availability" if="date:seconds(@timestamp) &lt; ancestor::e:entries/@start_timestamp"/>
                <element-ignore in="Availability" if="date:seconds(@timestamp) &gt; ancestor::e:entries/@end_timestamp"/>

            </elements>



            <element in="e:entries" if="$start_date!='_DATE_'">
                <attribute-create out="url">concat('/',$view_details,'?report=',$report,
                    '&amp;end_date=',$end_date,'&amp;start_date=',$start_date,'&amp;granularity=',$granularity,'&amp;site=')
                </attribute-create>
                <attribute-create out="status_url">concat('/status-site','?report=',$report,
                    '&amp;end=',$end_date,'&amp;start=',$start_date,'&amp;accept=html&amp;site=')
                </attribute-create>
            </element>

            <element in="e:entries" if="$start_date='_DATE_'">
                <attribute-create out="url">concat('/',$view_details,'?report=',$report,
                    '&amp;end_date=',substring(date:date(),0,11),'&amp;start_date=',substring(date:add(date:date(),'-P30D'),0,11),'&amp;granularity=',$granularity,'&amp;site=')
                </attribute-create>
                <attribute-create out="status_url">concat('/status-site','?report=',$report,
                    '&amp;end=',substring(date:date(),0,11),'&amp;start=',substring(date:add(date:date(),'-P30D'),0,11),'&amp;accept=html&amp;site=')
                </attribute-create>
            </element>




        </processors>

        <pre-renderers><namespace prefix="date" uri="http://exslt.org/dates-and-times"/><namespace prefix="e" uri="http://software.in2p3.fr/lavoisier/entries.xsd"/>
            <title>'Availabilities Reliabilities Chart'</title>
            <row foreach="/e:entries/Entity/Availability">
                <column label="entity">ancestor::Entity/@name</column>
                <column label="timestamp">@timestamp</column>
                <column unit="percentage" label="availability">format-number(@availability,'#.00')</column>
                <column unit="percentage" label="reliability">format-number(@reliability,'#.00')</column>
            </row>
        </pre-renderers>
        <renderers>

            <renderer type="DefaultRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">/html/ar_custom_reports.html</parameter>

            </renderer>
            <renderer type="ChartRenderer">
                <parameter name="options">
                    <entry key="rotation">-45</entry>
                </parameter>
            </renderer>
        </renderers>


    </view>

    <view name="services_ar">
        <info>
            <category>AR reports</category>
            <description>Site Customized Reports</description>
        </info>


        <argument name="site"/>


        <argument name="granularity"/>
        <argument name="month"/>

        <argument name="start_date" eval="concat($month,'-01')"/>
        <argument name="end_date" eval="concat($monthend,'-01')"/>
        <argument name="poems">ch.cern.sam.ROC_CRITICAL</argument>
        <argument name="report">report</argument>


        <!--<connector type="XMLConnector">-->
        <!--<parameter name="content" eval="view('services_daily_results')"></parameter>-->
        <!--</connector>-->

        <connector type="XMLConnector">

            <parameter name="content" eval="view('api.availability.services.call',             entry('granularity',$granularity)             | entry('report',$report)             | entry('group_type','service')             | entry('start_time',concat($start_date,'T00:00:00Z'))             | entry('end_time',concat($end_date,'T00:00:00Z'))             | entry('site',$site)             )"/>
        </connector>

        <processors>


            <element in="root" out="e:entries">
                <attribute-create out="report">$report</attribute-create>
                <element in="group" out="Site" if="@name=$site">
                    <attribute in="name" out="site"/>
                    <element in="group" out="Flavor">
                        <attribute in="name" out="Flavor"/>
                        <element in="results" out="Availability"/>
                    </element>
                </element>

                <element-ignore/>
            </element>



            <!--<select match="/root/Profile"></select>-->
            <!--<select  match="/e:entries/Profile/Site[@Site=$site]"></select>-->


            <processor match="/e:entries" type="InsertProcessor"><namespaces><entry key="date">http://exslt.org/dates-and-times</entry><entry key="e">http://software.in2p3.fr/lavoisier/entries.xsd</entry></namespaces><parameter name="nodes" eval="new_attribute('start_timestamp',date:seconds($start_date))"/></processor>
            <processor match="/e:entries" type="InsertProcessor"><namespaces><entry key="date">http://exslt.org/dates-and-times</entry><entry key="e">http://software.in2p3.fr/lavoisier/entries.xsd</entry></namespaces><parameter name="nodes" eval="new_attribute('end_timestamp',date:seconds($end_date))"/></processor>

            <processor match="/e:entries/Site/Flavor/Availability[date:seconds(@timestamp) &lt; ancestor::e:entries/@start_timestamp ]" type="RemoveProcessor"><namespaces><entry key="date">http://exslt.org/dates-and-times</entry><entry key="e">http://software.in2p3.fr/lavoisier/entries.xsd</entry></namespaces></processor>
            <processor match="/e:entries/Site/Flavor/Availability[date:seconds(@timestamp) &gt; ancestor::e:entries/@end_timestamp ]" type="RemoveProcessor"><namespaces><entry key="date">http://exslt.org/dates-and-times</entry><entry key="e">http://software.in2p3.fr/lavoisier/entries.xsd</entry></namespaces></processor>
            <processor match="/e:entries/Site" type="RenameProcessor"><namespaces><entry key="date">http://exslt.org/dates-and-times</entry><entry key="e">http://software.in2p3.fr/lavoisier/entries.xsd</entry></namespaces><parameter name="node_name">Entity</parameter></processor>
            <processor match="/e:entries/Entity/@site" type="RenameProcessor"><namespaces><entry key="date">http://exslt.org/dates-and-times</entry><entry key="e">http://software.in2p3.fr/lavoisier/entries.xsd</entry></namespaces><parameter name="node_name">name</parameter></processor>
        </processors>

        <pre-renderers><namespace prefix="date" uri="http://exslt.org/dates-and-times"/><namespace prefix="e" uri="http://software.in2p3.fr/lavoisier/entries.xsd"/>
            <title>'Availabilities Reliabilities Chart'</title>
            <row foreach="/e:entries/Entity/Flavor/Availability">
                <column label="entity">ancestor::Entity/@name</column>
                <column label="entity">ancestor::Flavor/@Flavor</column>
                <column label="timestamp">@timestamp</column>
                <column unit="percentage" label="availability">format-number(@availability,'#.00')</column>
                <column unit="percentage" label="reliability">format-number(@reliability,'#.00')</column>
            </row>
        </pre-renderers>
        <renderers>

            <renderer type="DefaultRenderer">
                <parameter name="template">/html/ar_SF_custom_reports.html</parameter>

            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">/html/ar_SF_custom_reports.html</parameter>

            </renderer>
            <renderer type="ChartRenderer">
                <parameter name="options">
                    <entry key="rotation">-45</entry>
                </parameter>
            </renderer>
        </renderers>


    </view>

    <view name="customFactors">


        <info>
            <category>AR reports</category>
            <description>Custom factor display</description>
        </info>

        <connector type="XMLConnector">
            <parameter name="content" eval="view('ComputationPowerRaw')"/>
        </connector>

        <processors>



                <element in="root">
                    <set variable="gocdb">view('goc.siteList')/results</set>
                    <element in="Factor">
                        <attribute-create out="ngi">choose($gocdb/SITE[@NAME=current()/../@site]/ROC/text(),$gocdb/SITE[@NAME=current()/../@site]/ROC/text(),'NA')</attribute-create>
                    </element>
                </element>

                <element in="root">                    
                    <element-ignore in="Factor"></element-ignore>
                    <element-create>sort_by_string(../Factor,'@ngi')</element-create>
                </element>


                <element in="root">
                    <element-create-as-parent out="ngi" group-by="@ngi" attributes="@ngi">
                        <element in="Factor"></element>
                    </element-create-as-parent>
                </element>


                <element in="root" out="nodeData">
                    <set variable="colorNgi">view('ngi_reports')</set>
                    <set variable="colorSite">view('site_reports')</set>
                    <element in="ngi" out="children">
                        <attribute-create out="color">choose($colorNgi/e:entries/e:entries/e:entry[@key=current()/../@ngi]/Availability[position()=last()]/@availability,
                            $colorNgi/e:entries/e:entries/e:entry[@key=current()/../@ngi]/Availability[position()=last()]/@availability,'NA')</attribute-create>
                        <element in="Factor" out="children">
                            <attribute-create out="color">choose($colorSite/e:entries/e:entries/e:entry[@key=current()/../@site]/Availability[position()=last()]/@availability,
                                $colorSite/e:entries/e:entries/e:entry[@key=current()/../@site]/Availability[position()=last()]/@availability,'NA')</attribute-create>
                        </element>
                    </element>

                </element>

            <element in="nodeData">
                    <element in="children">
                        <attribute in="ngi" out="id"></attribute>
                        <attribute in="color">round(.) div 100</attribute>
                        <attribute-create out="Parent">'EGI'</attribute-create>
                        <element in="children">
                            <attribute in="site" out="id"></attribute>
                            <attribute in="ngi" out="Parent"></attribute>
                            <attribute in="color">round(.) div 100</attribute>
                        </element>
                    </element>
            </element>

            <element in="nodeData">
                <element-ignore in="children">
                    <element in="children"></element>
                    <element-create>../../children</element-create>
                </element-ignore>
            </element>

            <element in="nodeData">
                <element-ignore in="children"></element-ignore>
                <element-create>uniq(../children,'@id')</element-create>
            </element>
            <element in="nodeData">
                <element in="children">
                    <element-ignore></element-ignore>
                </element>
            </element>

            <element in="nodeData">
                <element-ignore in="children" if="@Parent='NA'"/>
                <element in="children"/>
            </element>

            <element in="nodeData">

                <element in="children">
                    <attribute in="color" if=".='NaN'">0</attribute>
                </element>
            </element>

        </processors>
        <cache type="FileCache">
            <!--<trigger type="ViewCreatedTrigger"/>-->
            <!--<trigger type="DeltaTimeTrigger">-->
                <!--<parameter name="hours">4</parameter>-->
            <!--</trigger>-->
            <!--<trigger type="ViewNotifiedTrigger"/>-->
            <trigger type="ViewCreatedTrigger"/>
        </cache>

        <renderers>

            <renderer type="DefaultRenderer">
                <parameter name="template">/html/factors.html</parameter>

            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">/html/factors.html</parameter>

            </renderer>
            <renderer type="JSONRenderer">
                <parameter name="element_as_array">true</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="site_HR_comparison">
        <info>
            <category>AR reports</category>
            <description>Site Customized Reports</description>
        </info>
        <argument name="site"/>
        <argument name="ngi">NGI_HR</argument>
        <argument name="granularity">DAILY</argument>

        <argument name="month">1970-01</argument>
        <argument name="monthend" eval="choose($month!='1970-01',substring(date:add($month,'P1M'),0,8))"/>

        <argument name="start_date" eval="choose($month='1970-01','_DATE_',concat($month,'-01'))"/>
        <argument name="end_date" eval="choose($month='1970-01','_DATE_',concat($monthend,'-01'))"/>



        <argument name="view_details">ar-service</argument>
        <argument name="poems">ch.cern.sam.ROC_CRITICAL</argument>
        <argument name="report">Critical</argument>
        <variable name="start_time" eval="choose($start_date!='_DATE_',concat($start_date,'T00:00:00Z'),concat(substring(date:add(date:date-time(),'-P30D'), 0,11),'T00:00:00Z'))"/>
        <variable name="end_time" eval="choose($end_date!='_DATE_',concat($end_date,'T00:00:00Z'),concat(substring(date:add(date:date-time(),'-P1D'), 0,11),'T00:00:00Z'))"/>


        <connector type="XMLConnector">

            <parameter name="content" eval="view('api.availability.rotating.caches',             entry('granularity',$granularity)             | entry('report','NGIHRTest')             | entry('group_type','sites')             | entry('start_time',$start_time)             | entry('end_time',$end_time)                       )"/>
        </connector>

        <processors>

            <element in="root" out="e:entries">

                <attribute-create out="start_timestamp">date:seconds($start_time)</attribute-create>
                <attribute-create out="end_timestamp">date:seconds($end_time)</attribute-create>

                <attribute-create out="start_date">$start_time</attribute-create>
                <attribute-create out="end_date">$end_time</attribute-create>

                <attribute-create out="view">ar-site</attribute-create>
                <attribute-create out="view_details">$view_details</attribute-create>
                <attribute-create out="report">$report</attribute-create>

                <element in="group" if="@name=$ngi or $ngi='false'">
                    <element in="group" out="Site">
                        <element in="results" out="Availability"/>
                    </element>
                </element>
                <element-ignore/>
            </element>

            <element in="e:entries">
                <element-ignore in="group">

                    <element in="Site" out="Entity">
                        <attribute-create out="NGI">../ancestor::group/@name</attribute-create>
                    </element>
                </element-ignore>
            </element>

            <elements path="e:entries">
                <element-create>view('api.availability.rotating.caches',
                    entry('granularity',$granularity)
                    | entry('report','NGIHRTest')
                    | entry('group_type','sites')
                    | entry('start_time',$start_time)
                    | entry('end_time',$end_time)
                    | entry('option','&amp;datasource=hbase'))
                </element-create>
            </elements>

            <elements path="e:entries/Entity">
                <element-ignore in="Availability" if="date:seconds(@timestamp) &lt; ancestor::e:entries/@start_timestamp"/>
                <element-ignore in="Availability" if="date:seconds(@timestamp) &gt; ancestor::e:entries/@end_timestamp"/>
            </elements>

            <elements path="e:entries/Entity">
                <element in="Availability">
                    <attribute-create out="availability_HR">
                        ../../../root/group/group[@name=current()/../../@name]/results[@timestamp=current()/../@timestamp]/@availability
                    </attribute-create>
                    <attribute-create out="reliability_HR">
                        ../../../root/group/group[@name=current()/../../@name]/results[@timestamp=current()/../@timestamp]/@reliability
                    </attribute-create>
                    <attribute-create out="unknown_HR">
                        ../../../root/group/group[@name=current()/../../@name]/results[@timestamp=current()/../@timestamp]/@unknown
                    </attribute-create>
                    <attribute-create out="uptime_HR">
                        ../../../root/group/group[@name=current()/../../@name]/results[@timestamp=current()/../@timestamp]/@uptime
                    </attribute-create>
                    <attribute-create out="downtime_HR">
                        ../../../root/group/group[@name=current()/../../@name]/results[@timestamp=current()/../@timestamp]/@downtime
                    </attribute-create>
                </element>
            </elements>



            <elements path="e:entries/Entity">
                <element in="Availability"/>
                <element-ignore/>
            </elements>




        </processors>

        <pre-renderers><namespace prefix="date" uri="http://exslt.org/dates-and-times"/><namespace prefix="e" uri="http://software.in2p3.fr/lavoisier/entries.xsd"/>
            <title>'Availabilities Reliabilities Chart'</title>
            <row foreach="/e:entries/Entity/Availability">
                <column label="entity">ancestor::Entity/@name</column>
                <column label="timestamp">@timestamp</column>
                
                <column unit="percentage" label="availability">format-number(@availability,'#.00')</column>
                <column unit="percentage" label="availability_hbase">format-number(@availability_HR,'#.00')</column>
                
                <column unit="percentage" label="reliability">format-number(@reliability,'#.00')</column>             
                <column unit="percentage" label="reliability_hbase">format-number(@reliability_HR,'#.00')</column>

                <column unit="percentage" label="unknown">format-number(@unknown,'#.00')</column>
                <column unit="percentage" label="unknown_hbase">format-number(@unknown_HR,'#.00')</column>

                <column unit="percentage" label="uptime">format-number(@uptime,'#.00')</column>
                <column unit="percentage" label="uptime_hbase">format-number(@uptime_HR,'#.00')</column>

                <column unit="percentage" label="downtime">format-number(@downtime,'#.00')</column>
                <column unit="percentage" label="downtime_hbase">format-number(@downtime_HR,'#.00')</column>
                
            </row>
        </pre-renderers>
        <renderers>

            <renderer type="DefaultRenderer">
                <parameter name="template">/html/comparison.html</parameter>

            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">/html/comparison.html</parameter>

            </renderer>
            <renderer type="ChartRenderer">
                <parameter name="options">
                    <entry key="rotation">-45</entry>
                </parameter>
            </renderer>
        </renderers>


    </view>


</config>