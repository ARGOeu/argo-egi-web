<config xmlns="http://software.in2p3.fr/lavoisier/config.xsd" version="16">
    <authenticators name="auth_chain">
        <authenticator type="WhiteListHTTPBasicAuthenticator" authorized="user()='lavoisier'">
            <parameter name="passwords" eval="view_path('properties', '/security/passwords.properties')"/>
        </authenticator>
        <authenticator type="IPAddressAuthenticator">
            <parameter name="addresses">
                <entry>127.0.0.1</entry>
                <entry>0:0:0:0:0:0:0:1</entry>
            </parameter>
        </authenticator>
        <authenticator type="X509Authenticator" authorized="user()='EMAILADDRESS=lionel.schwarz@in2p3.fr, CN=Lionel Schwarz, OU=USR6402, O=CNRS, C=FR'
                                                         or user()='EMAILADDRESS=Sylvain.Reynaud@in2p3.fr, CN=Sylvain Reynaud, OU=USR6402, O=CNRS, C=FR'"/>
        <authenticator type="CASAuthenticator" authorized="user()='lionel.schwarz@in2p3.fr' or user()='Sylvain.Reynaud@in2p3.fr'">
            <parameter name="server" eval="property('cas.server')"/>
        </authenticator>
    </authenticators>
    <view name="restricted" authenticators="auth_chain">
        <info>
            <category>test</category>
        </info>
        <connector type="StringConnector">
            <parameter name="content" eval="user()"/>
        </connector>
        <serializer type="EncapsulateSerializer">
            <parameter name="cdata">false</parameter>
        </serializer>
    </view>

    <authenticators name="chained">
        <authenticator type="IPAddressAuthenticator">
            <parameter name="addresses">
                <entry>0.0.0.0</entry>
            </parameter>
        </authenticator>
        <authenticator type="CASAuthenticator" authorized="user()='lionel.schwarz@in2p3.fr' or user()='Sylvain.Reynaud@in2p3.fr'">
            <parameter name="server">https://serverCas.domain</parameter>
        </authenticator>
    </authenticators>
    <view name="restricted_chained" authenticators="chained">
        <info>
            <category>test</category>
        </info>
        <connector type="StringConnector">
            <parameter name="content">SECRET</parameter>
        </connector>
        <serializer type="EncapsulateSerializer">
            <parameter name="cdata">false</parameter>
        </serializer>
    </view>

    <authenticators name="password_dummy">
        <authenticator type="WhiteListHTTPBasicAuthenticator" authorized="user()='dummy'">
            <parameter name="passwords" eval="view_path('properties', '/security/passwords.properties')"/>
        </authenticator>
    </authenticators>
    <view name="restricted_password_dummy" authenticators="password_dummy">
        <info>
            <category>test</category>
        </info>
        <connector type="StringConnector">
            <parameter name="content">SECRET</parameter>
        </connector>
        <serializer type="EncapsulateSerializer">
            <parameter name="cdata">false</parameter>
        </serializer>
    </view>

    <!-- This view is used to test sessions, do not uncomment if your are not in scope TEST -->
    <!-- 
    <authenticators name="ok">
        <authenticator type="fr.in2p3.lavoisier.adaptor.DummyAuthenticator"/>
    </authenticators>
    <view name="session" authenticators="ok">
        <connector type="StringConnector">
            <parameter name="content" eval="user()"/>
        </connector>
        <serializer type="EncapsulateSerializer">
            <parameter name="cdata">false</parameter>
        </serializer>
    </view>
     -->
     
    <view name="sendback">
        <info>
            <category>Hidden</category>
        </info>
        <connector type="XMLConnector">
            <parameter name="content" eval="post()"/>
        </connector>
        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">application/xml</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="example">
        <info>
            <category>Main</category>
            <accept>chart</accept>
            <description>Test rendering of a simple XML data view</description>
        </info>
        <argument name="axis" pattern="normal|inverted|polar">polar</argument>
        <argument name="stacking" pattern="none|normal|percent">none</argument>
        <connector type="StringConnector">
            <parameter name="content"><![CDATA[
Month;A;B
January;8343;2446
February;7684;3935
March;6983;3452
April;8345;4424
May;8195;4925
June;6983;4328]]></parameter>
        </connector>
        <serializer type="CSVSerializer">
            <parameter name="header">true</parameter>
        </serializer>
        <processors xmlns:t="http://software.in2p3.fr/lavoisier/tables.xsd">
            <element in="t:tables" out="data">
                <element-ignore in="t:table">
                    <element-ignore in="t:column_labels"/>
                    <element in="t:row" out="products">
                        <set variable="avg">sum(*[@label!='Month']) div 2</set>
                        <element-create>new_element('average',$avg)</element-create>
                        <element-ignore in="t:column">
                            <element-create>new_element(../@label,../text())</element-create>
                        </element-ignore>
                    </element>
                </element-ignore>
            </element>
        </processors>
        <cache type="FileCache">
            <trigger type="ViewCreatedTrigger" ignore-during="PT1H"/>
            <trigger type="ViewNotifiedTrigger"/>
        </cache>
        <renderers>
            <renderer type="ChartRenderer">
                <parameter name="type">line</parameter>
                <parameter name="axis" eval="$axis"/>
                <parameter name="stacking" eval="$stacking"/>
            </renderer>
            <renderer type="ChartRenderer2">
                <parameter name="types">
                    <entry key="*">area</entry>
                </parameter>
                <parameter name="axis" eval="$axis"/>
                <parameter name="stacking" eval="$stacking"/>
            </renderer>
            <renderer type="CsvRenderer">
                <parameter name="separator">;</parameter>
            </renderer>
            <renderer type="JSONRenderer">
                <parameter name="texts">
                    <entry>Month</entry><entry>A</entry><entry>B</entry><entry>average</entry>
                </parameter>
                <parameter name="skip">
                    <entry key="data">none</entry>
                </parameter>
                <parameter name="arrays">
                    <entry>products</entry>
                </parameter>
            </renderer>
        </renderers>
    </view>
</config>