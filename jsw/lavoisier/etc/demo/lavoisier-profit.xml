<config xmlns="http://software.in2p3.fr/lavoisier/config.xsd" version="14">
    <view name="profit">
        <info>
            <category>profit</category>
        </info>
        <connector type="HTTPConnector">
            <parameter name="url">http://software.in2p3.fr/lavoisier/input.csv</parameter>
        </connector>
        <serializer type="CSVSerializer">
            <parameter name="header">true</parameter>
        </serializer>
        <processors xmlns:ns_0="http://software.in2p3.fr/lavoisier/rendering.xsd">
            <processor match="/ns_0:rendering/ns_0:rows/ns_0:row/ns_0:column[@label='Profit']/text()" type="SelectProcessor"/>
        </processors>
        <renderers>
            <renderer type="HTMLRenderer">
                <parameter name="template">html/profit.html</parameter>
            </renderer>
        </renderers>
    </view>
    <view name="profit_invoices">
        <info>
            <category>Main</category>
            <description>Simple demo of merging CSV and JSON data sources</description>
        </info>
        <connector type="StringConnector">
            <parameter name="content">{"invoices":["128","243","187","306","247","203"]}</parameter>
        </connector>
        <serializer type="JSONSerializer"/>
        <processors>
            <processor type="RemoveProcessor" match="/*">
                <parameter name="depth">1</parameter>
            </processor>
            <processor type="ReplaceProcessor" match="/invoices/item/text()">
                <parameter name="nodes" eval="new_element('invoices', .)"/>
            </processor>
            <processor type="InsertProcessor" match="/invoices/item">
                <parameter name="nodes" eval="new_attribute('profit', view('profit')/*/*[position()=position(match())])"/>
            </processor>
            <processor type="InsertProcessor" match="/invoices/item[invoices]">
                <parameter name="nodes" eval="view('ratio', entries(entry('profit',@profit), entry('invoices',invoices)))"/>
            </processor>
        </processors>
        <pre-renderers>
            <title>'Profit / Number of invoices'</title>
            <row foreach="/invoices/item">
                <column unit="$" order="descending">@profit</column>
                <column unit="nb">invoices</column>
                <column unit="$" label="ratio">(round(ratio * 100) div 100)</column>
            </row>
        </pre-renderers>
        <renderers>
            <renderer type="CsvRenderer">
                <parameter name="separator">;</parameter>
            </renderer>
        </renderers>
    </view>
    <view name="ratio">
        <info>
            <category>profit</category>
        </info>
        <argument name="profit"/>
        <argument name="invoices"/>
        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('ratio', 100 * $profit div $invoices)"/>
        </connector>
    </view>
</config>